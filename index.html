<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoVault - Professional Multi-Chain Wallet</title>
    <meta name="description" content="Professional cryptocurrency wallet supporting 16+ blockchains">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            margin: 0; 
            padding: 0;
            background: #f5f7fa;
        }
        
        .dark body {
            background: #0f1419;
        }
        
        .professional-gradient {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }
        
        .card {
            background: white;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .dark .card {
            background: #1a1f2e;
            border: 1px solid #2d3748;
        }
        
        .btn-primary {
            background: #3b82f6;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .spinner { 
            display: inline-block;
            animation: spin 1s linear infinite; 
        }
        
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
        
        input, textarea, select {
            border: 1px solid #d1d5db;
            transition: all 0.2s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .dark input, .dark textarea, .dark select {
            background: #1f2937;
            border-color: #374151;
            color: #f9fafb;
        }

        .chain-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }

        .chain-card {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .chain-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .chain-card.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .dark .chain-card {
            border-color: #374151;
        }

        .dark .chain-card:hover {
            border-color: #3b82f6;
            background: #1e3a8a;
        }

        .dark .chain-card.selected {
            background: #1e40af;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .token-item {
            padding: 16px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .token-item:hover {
            border-color: #3b82f6;
            background: #f9fafb;
        }

        .dark .token-item {
            border-color: #374151;
        }

        .dark .token-item:hover {
            border-color: #3b82f6;
            background: #1f2937;
        }

        .investor-badge {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: 2px solid #b8860b;
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            color: #000;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            API: {
                // These will be moved to backend in production
                INFURA_KEY: '2eb003d772d345c48214cad05878e67c',
                ALCHEMY_KEY: 'RV7R38aklgHvDsNjslY6Xo9ptfJ--r2t',
                BACKEND_URL: process.env.REACT_APP_BACKEND_URL || 'http://localhost:3001'
            },
            FEATURES: {
                SOLANA: true,
                ANALYTICS: true,
                INVESTOR_CARDS: true,
                TOKENS: true,
                GAS_ESTIMATION: true
            },
            LIMITS: {
                MAX_INVESTOR_CARDS: 1000
            }
        };

        // ============================================
        // BLOCKCHAIN CONFIGURATIONS
        // ============================================
        const CHAINS = {
            ETH: {
                name: 'Ethereum',
                symbol: 'ETH',
                decimals: 18,
                color: '#627EEA',
                testnet: {
                    rpc: [
                        `https://sepolia.infura.io/v3/${CONFIG.API.INFURA_KEY}`,
                        `https://eth-sepolia.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://rpc.sepolia.org'
                    ],
                    explorer: 'https://sepolia.etherscan.io',
                    chainId: 11155111
                },
                mainnet: {
                    rpc: [
                        `https://mainnet.infura.io/v3/${CONFIG.API.INFURA_KEY}`,
                        `https://eth-mainnet.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://eth.llamarpc.com'
                    ],
                    explorer: 'https://etherscan.io',
                    chainId: 1
                }
            },
            SOLANA: {
                name: 'Solana',
                symbol: 'SOL',
                decimals: 9,
                color: '#14F195',
                isSolana: true,
                testnet: {
                    rpc: ['https://api.devnet.solana.com'],
                    explorer: 'https://explorer.solana.com?cluster=devnet',
                    chainId: 0
                },
                mainnet: {
                    rpc: ['https://api.mainnet-beta.solana.com'],
                    explorer: 'https://explorer.solana.com',
                    chainId: 0
                }
            },
            BNB: {
                name: 'BNB Chain',
                symbol: 'BNB',
                decimals: 18,
                color: '#F3BA2F',
                testnet: {
                    rpc: [
                        'https://bsc-testnet.publicnode.com',
                        'https://data-seed-prebsc-1-s1.binance.org:8545'
                    ],
                    explorer: 'https://testnet.bscscan.com',
                    chainId: 97
                },
                mainnet: {
                    rpc: [
                        'https://bsc-dataseed1.binance.org',
                        'https://bsc.publicnode.com'
                    ],
                    explorer: 'https://bscscan.com',
                    chainId: 56
                }
            },
            POLYGON: {
                name: 'Polygon',
                symbol: 'MATIC',
                decimals: 18,
                color: '#8247E5',
                testnet: {
                    rpc: [
                        `https://polygon-amoy.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://rpc-amoy.polygon.technology'
                    ],
                    explorer: 'https://amoy.polygonscan.com',
                    chainId: 80002
                },
                mainnet: {
                    rpc: [
                        `https://polygon-mainnet.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://polygon-rpc.com'
                    ],
                    explorer: 'https://polygonscan.com',
                    chainId: 137
                }
            },
            ARBITRUM: {
                name: 'Arbitrum',
                symbol: 'ETH',
                decimals: 18,
                color: '#28A0F0',
                testnet: {
                    rpc: [
                        `https://arb-sepolia.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://sepolia-rollup.arbitrum.io/rpc'
                    ],
                    explorer: 'https://sepolia.arbiscan.io',
                    chainId: 421614
                },
                mainnet: {
                    rpc: [
                        `https://arb-mainnet.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://arb1.arbitrum.io/rpc'
                    ],
                    explorer: 'https://arbiscan.io',
                    chainId: 42161
                }
            },
            OPTIMISM: {
                name: 'Optimism',
                symbol: 'ETH',
                decimals: 18,
                color: '#FF0420',
                testnet: {
                    rpc: [
                        `https://opt-sepolia.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://sepolia.optimism.io'
                    ],
                    explorer: 'https://sepolia-optimism.etherscan.io',
                    chainId: 11155420
                },
                mainnet: {
                    rpc: [
                        `https://opt-mainnet.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://mainnet.optimism.io'
                    ],
                    explorer: 'https://optimistic.etherscan.io',
                    chainId: 10
                }
            },
            BASE: {
                name: 'Base',
                symbol: 'ETH',
                decimals: 18,
                color: '#0052FF',
                testnet: {
                    rpc: [
                        `https://base-sepolia.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://sepolia.base.org'
                    ],
                    explorer: 'https://sepolia.basescan.org',
                    chainId: 84532
                },
                mainnet: {
                    rpc: [
                        `https://base-mainnet.g.alchemy.com/v2/${CONFIG.API.ALCHEMY_KEY}`,
                        'https://mainnet.base.org'
                    ],
                    explorer: 'https://basescan.org',
                    chainId: 8453
                }
            },
            AVAX: {
                name: 'Avalanche',
                symbol: 'AVAX',
                decimals: 18,
                color: '#E84142',
                testnet: {
                    rpc: ['https://api.avax-test.network/ext/bc/C/rpc'],
                    explorer: 'https://testnet.snowtrace.io',
                    chainId: 43113
                },
                mainnet: {
                    rpc: ['https://api.avax.network/ext/bc/C/rpc'],
                    explorer: 'https://snowtrace.io',
                    chainId: 43114
                }
            },
            FANTOM: {
                name: 'Fantom',
                symbol: 'FTM',
                decimals: 18,
                color: '#1969FF',
                testnet: {
                    rpc: ['https://rpc.testnet.fantom.network'],
                    explorer: 'https://testnet.ftmscan.com',
                    chainId: 4002
                },
                mainnet: {
                    rpc: ['https://rpc.ftm.tools'],
                    explorer: 'https://ftmscan.com',
                    chainId: 250
                }
            },
            ZKSYNC: {
                name: 'zkSync Era',
                symbol: 'ETH',
                decimals: 18,
                color: '#8C8DFC',
                testnet: {
                    rpc: ['https://sepolia.era.zksync.dev'],
                    explorer: 'https://sepolia.explorer.zksync.io',
                    chainId: 300
                },
                mainnet: {
                    rpc: ['https://mainnet.era.zksync.io'],
                    explorer: 'https://explorer.zksync.io',
                    chainId: 324
                }
            },
            SCROLL: {
                name: 'Scroll',
                symbol: 'ETH',
                decimals: 18,
                color: '#FFEEDA',
                testnet: {
                    rpc: ['https://sepolia-rpc.scroll.io'],
                    explorer: 'https://sepolia.scrollscan.com',
                    chainId: 534351
                },
                mainnet: {
                    rpc: ['https://rpc.scroll.io'],
                    explorer: 'https://scrollscan.com',
                    chainId: 534352
                }
            },
            MANTLE: {
                name: 'Mantle',
                symbol: 'MNT',
                decimals: 18,
                color: '#000000',
                testnet: {
                    rpc: ['https://rpc.sepolia.mantle.xyz'],
                    explorer: 'https://sepolia.mantlescan.xyz',
                    chainId: 5003
                },
                mainnet: {
                    rpc: ['https://rpc.mantle.xyz'],
                    explorer: 'https://mantlescan.xyz',
                    chainId: 5000
                }
            },
            LINEA: {
                name: 'Linea',
                symbol: 'ETH',
                decimals: 18,
                color: '#121212',
                testnet: {
                    rpc: ['https://rpc.goerli.linea.build'],
                    explorer: 'https://goerli.lineascan.build',
                    chainId: 59140
                },
                mainnet: {
                    rpc: ['https://rpc.linea.build'],
                    explorer: 'https://lineascan.build',
                    chainId: 59144
                }
            },
            APECHAIN: {
                name: 'ApeChain',
                symbol: 'APE',
                decimals: 18,
                color: '#0051DA',
                testnet: {
                    rpc: ['https://curtis.rpc.caldera.xyz/http'],
                    explorer: 'https://curtis.explorer.caldera.xyz',
                    chainId: 33111
                },
                mainnet: {
                    rpc: ['https://apechain.caldera.dev/http'],
                    explorer: 'https://apechain.calderaexplorer.xyz',
                    chainId: 33139
                }
            }
        };

        // Token addresses for major chains
        const TOKEN_ADDRESSES = {
            ETH: {
                USDT: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                USDC: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48'
            },
            BNB: {
                USDT: '0x55d398326f99059fF775485246999027B3197955',
                USDC: '0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d'
            },
            POLYGON: {
                USDT: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F',
                USDC: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174'
            },
            ARBITRUM: {
                USDT: '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9',
                USDC: '0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8'
            },
            OPTIMISM: {
                USDT: '0x94b008aA00579c1307B0EF2c499aD98a8ce58e58',
                USDC: '0x7F5c764cBc14f9669B88837ca1490cCa17c31607'
            }
        };

        const ERC20_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function decimals() view returns (uint8)",
            "function symbol() view returns (string)",
            "function transfer(address to, uint256 amount) returns (bool)",
            "function name() view returns (string)"
        ];

        // ============================================
        // SOLANA MANAGER
        // ============================================
        const SolanaManager = {
            createWallet: () => {
                try {
                    const keypair = solanaWeb3.Keypair.generate();
                    return {
                        address: keypair.publicKey.toString(),
                        privateKey: Buffer.from(keypair.secretKey).toString('hex'),
                        keypair: keypair
                    };
                } catch (e) {
                    console.error('Solana wallet creation error:', e);
                    return null;
                }
            },
            
            importWallet: (privateKeyHex) => {
                try {
                    const secretKey = Uint8Array.from(Buffer.from(privateKeyHex, 'hex'));
                    const keypair = solanaWeb3.Keypair.fromSecretKey(secretKey);
                    return {
                        address: keypair.publicKey.toString(),
                        privateKey: privateKeyHex,
                        keypair: keypair
                    };
                } catch (e) {
                    console.error('Solana wallet import error:', e);
                    return null;
                }
            },
            
            getBalance: async (address, isTestnet = true) => {
                try {
                    const endpoint = isTestnet 
                        ? 'https://api.devnet.solana.com'
                        : 'https://api.mainnet-beta.solana.com';
                    
                    const connection = new solanaWeb3.Connection(endpoint);
                    const publicKey = new solanaWeb3.PublicKey(address);
                    const balance = await connection.getBalance(publicKey);
                    
                    return (balance / solanaWeb3.LAMPORTS_PER_SOL).toFixed(6);
                } catch (e) {
                    console.error('Solana balance error:', e);
                    return '0.000000';
                }
            },
            
            sendTransaction: async (fromKeypair, toAddress, amount, isTestnet = true) => {
                try {
                    const endpoint = isTestnet 
                        ? 'https://api.devnet.solana.com'
                        : 'https://api.mainnet-beta.solana.com';
                    
                    const connection = new solanaWeb3.Connection(endpoint);
                    const toPublicKey = new solanaWeb3.PublicKey(toAddress);
                    
                    const transaction = new solanaWeb3.Transaction().add(
                        solanaWeb3.SystemProgram.transfer({
                            fromPubkey: fromKeypair.publicKey,
                            toPubkey: toPublicKey,
                            lamports: amount * solanaWeb3.LAMPORTS_PER_SOL
                        })
                    );
                    
                    const signature = await solanaWeb3.sendAndConfirmTransaction(
                        connection,
                        transaction,
                        [fromKeypair]
                    );
                    
                    return { success: true, signature };
                } catch (e) {
                    console.error('Solana send error:', e);
                    return { success: false, error: e.message };
                }
            }
        };

        // ============================================
        // ANALYTICS MANAGER
        // ============================================
        const AnalyticsManager = {
            track: (eventName, properties = {}) => {
                if (!CONFIG.FEATURES.ANALYTICS) return;
                
                const event = {
                    name: eventName,
                    properties: {
                        ...properties,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        url: window.location.href
                    }
                };
                
                console.log('Analytics Event:', event);
                
                try {
                    const events = JSON.parse(localStorage.getItem('analytics_events') || '[]');
                    events.push(event);
                    localStorage.setItem('analytics_events', JSON.stringify(events.slice(-100)));
                } catch (e) {
                    console.error('Analytics storage error:', e);
                }
            },
            
            getEvents: () => {
                try {
                    return JSON.parse(localStorage.getItem('analytics_events') || '[]');
                } catch (e) {
                    return [];
                }
            }
        };

        // ============================================
        // INVESTOR CARD MANAGER
        // ============================================
        const InvestorCardManager = {
            getTotalMinted: () => {
                if (!CONFIG.FEATURES.INVESTOR_CARDS) return 0;
                try {
                    const data = localStorage.getItem('investor_cards');
                    if (!data) return 0;
                    const cards = JSON.parse(data);
                    return Object.keys(cards).length;
                } catch (e) {
                    return 0;
                }
            },

            hasCard: (address) => {
                if (!CONFIG.FEATURES.INVESTOR_CARDS) return false;
                try {
                    const data = localStorage.getItem('investor_cards');
                    if (!data) return false;
                    const cards = JSON.parse(data);
                    return !!cards[address.toLowerCase()];
                } catch (e) {
                    return false;
                }
            },

            getCard: (address) => {
                if (!CONFIG.FEATURES.INVESTOR_CARDS) return null;
                try {
                    const data = localStorage.getItem('investor_cards');
                    if (!data) return null;
                    const cards = JSON.parse(data);
                    return cards[address.toLowerCase()] || null;
                } catch (e) {
                    return null;
                }
            },

            mintCard: (address) => {
                if (!CONFIG.FEATURES.INVESTOR_CARDS) return { success: false, reason: 'feature_disabled' };
                
                try {
                    const total = InvestorCardManager.getTotalMinted();
                    
                    if (total >= CONFIG.LIMITS.MAX_INVESTOR_CARDS) {
                        return { success: false, reason: 'limit_reached' };
                    }

                    if (InvestorCardManager.hasCard(address)) {
                        return { success: false, reason: 'already_has_card', card: InvestorCardManager.getCard(address) };
                    }

                    const serialNumber = total + 1;
                    const card = {
                        serialNumber,
                        type: 'Investor Access Card',
                        owner: address,
                        claimTimestamp: new Date().toISOString(),
                        mintedAt: Date.now()
                    };

                    let cards = {};
                    const data = localStorage.getItem('investor_cards');
                    if (data) {
                        cards = JSON.parse(data);
                    }
                    cards[address.toLowerCase()] = card;
                    localStorage.setItem('investor_cards', JSON.stringify(cards));

                    AnalyticsManager.track('Investor_Card_Minted', { serialNumber, address });

                    return { success: true, card };
                } catch (e) {
                    console.error('Card minting error:', e);
                    return { success: false, reason: 'error' };
                }
            }
        };

        // ============================================
        // MAIN APP COMPONENT
        // ============================================
        function App() {
            // State Management
            const [wallet, setWallet] = useState(null);
            const [solanaWallet, setSolanaWallet] = useState(null);
            const [loading, setLoading] = useState(false);
            const [message, setMessage] = useState('');
            const [seedInput, setSeedInput] = useState('');
            const [view, setView] = useState('welcome');
            const [sendTo, setSendTo] = useState('');
            const [sendAmount, setSendAmount] = useState('');
            const [isTestnet, setIsTestnet] = useState(true);
            const [chain, setChain] = useState('ETH');
            const [txs, setTxs] = useState([]);
            const [showSeed, setShowSeed] = useState(false);
            const [darkMode, setDarkMode] = useState(false);
            const [prices, setPrices] = useState({});
            const [tokens, setTokens] = useState([]);
            const [loadingTokens, setLoadingTokens] = useState(false);
            const [selectedToken, setSelectedToken] = useState(null);
            const [sendTokenAmount, setSendTokenAmount] = useState('');
            const [solanaBalance, setSolanaBalance] = useState('0.000000');
            const [investorCard, setInvestorCard] = useState(null);
            const [showCardModal, setShowCardModal] = useState(false);
            const [gasEstimate, setGasEstimate] = useState(null);
            const qrRef = useRef(null);

            // Helper Functions
            const showMsg = (msg) => {
                setMessage(msg);
                setTimeout(() => setMessage(''), 4000);
            };

            const getProviderWithRetry = async () => {
                const c = CHAINS[chain];
                
                if (c.isSolana) {
                    return null;
                }
                
                const network = isTestnet ? c.testnet : c.mainnet;
                const rpcList = Array.isArray(network.rpc) ? network.rpc : [network.rpc];
                
                for (let i = 0; i < rpcList.length; i++) {
                    try {
                        const rpc = rpcList[i];
                        const provider = new ethers.providers.JsonRpcProvider(rpc);
                        await provider.getNetwork();
                        console.log(`Connected to ${chain} via RPC ${i + 1}`);
                        return provider;
                    } catch (e) {
                        console.error(`RPC ${i + 1} failed:`, e.message);
                        if (i === rpcList.length - 1) {
                            throw new Error(`All RPCs failed for ${chain}`);
                        }
                    }
                }
            };

            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(text);
                showMsg('Copied to clipboard');
                AnalyticsManager.track('Clipboard_Copy', { type: 'address' });
            };

            const getUsdValue = () => {
                if (chain === 'SOLANA' && CONFIG.FEATURES.SOLANA) {
                    if (!solanaWallet || !prices.SOL) return '0.00';
                    return (parseFloat(solanaBalance) * prices.SOL).toFixed(2);
                }
                
                if (!wallet || !prices[CHAINS[chain].symbol]) return '0.00';
                return (parseFloat(wallet.balance) * prices[CHAINS[chain].symbol]).toFixed(2);
            };

            const getCurrentBalance = () => {
                if (chain === 'SOLANA' && CONFIG.FEATURES.SOLANA) {
                    return solanaBalance;
                }
                return wallet ? wallet.balance : '0.000000';
            };

            const getCurrentAddress = () => {
                if (chain === 'SOLANA' && CONFIG.FEATURES.SOLANA) {
                    return solanaWallet ? solanaWallet.address : '';
                }
                return wallet ? wallet.address : '';
            };

            const checkAndMintCard = (walletAddress) => {
                const result = InvestorCardManager.mintCard(walletAddress);
                
                if (result.success) {
                    setInvestorCard(result.card);
                    setShowCardModal(true);
                    showMsg(`Congratulations! You received Investor Card #${result.card.serialNumber}`);
                } else if (result.reason === 'already_has_card'){
                    setInvestorCard(result.card);
                }
            };

            // Fetch cryptocurrency prices
            const fetchPrices = async () => {
                try {
                    const response = await fetch(
                        'https://api.coingecko.com/api/v3/simple/price?ids=ethereum,binancecoin,matic-network,avalanche-2,fantom,mantle,tether,usd-coin,solana&vs_currencies=usd'
                    );
                    const data = await response.json();
                    setPrices({
                        ETH: data.ethereum?.usd || 2500,
                        BNB: data.binancecoin?.usd || 300,
                        MATIC: data['matic-network']?.usd || 0.8,
                        AVAX: data['avalanche-2']?.usd || 25,
                        FTM: data.fantom?.usd || 0.4,
                        MNT: data.mantle?.usd || 0.8,
                        SOL: data.solana?.usd || 150,
                        USDT: 1.0,
                        USDC: 1.0,
                        APE: 1.2
                    });
                } catch (e) {
                    setPrices({ ETH: 2500, BNB: 300, MATIC: 0.8, AVAX: 25, FTM: 0.4, MNT: 0.8, SOL: 150, USDT: 1.0, USDC: 1.0, APE: 1.2 });
                }
            };

            // Load token balances
            const loadTokenBalances = async () => {
                if (!wallet || isTestnet || chain === 'SOLANA') return;
                
                setLoadingTokens(true);
                const tokenAddresses = TOKEN_ADDRESSES[chain] || {};
                const tokenList = [];
                
                try {
                    const provider = await getProviderWithRetry();
                    
                    for (const [symbol, address] of Object.entries(tokenAddresses)) {
                        try {
                            const contract = new ethers.Contract(address, ERC20_ABI, provider);
                            const [balance, decimals, name] = await Promise.all([
                                contract.balanceOf(wallet.address),
                                contract.decimals(),
                                contract.name()
                            ]);
                            
                            const formattedBalance = ethers.utils.formatUnits(balance, decimals);
                            
                            if (parseFloat(formattedBalance) > 0) {
                                tokenList.push({ symbol, name, address, balance: formattedBalance, decimals });
                            }
                        } catch (e) {
                            console.error(`Error loading ${symbol}:`, e.message);
                        }
                    }
                    
                    setTokens(tokenList);
                } catch (e) {
                    console.error('Token loading error:', e);
                }
                
                setLoadingTokens(false);
            };

            // Estimate gas fees
            const estimateGas = async (to, amount) => {
                if (!CONFIG.FEATURES.GAS_ESTIMATION || chain === 'SOLANA') return;
                
                try {
                    const provider = await getProviderWithRetry();
                    const gasPrice = await provider.getGasPrice();
                    const gasLimit = 21000; // Standard ETH transfer
                    
                    const gasCost = gasPrice.mul(gasLimit);
                    const gasCostEth = ethers.utils.formatEther(gasCost);
                    const gasCostUsd = (parseFloat(gasCostEth) * (prices[CHAINS[chain].symbol] || 0)).toFixed(2);
                    
                    setGasEstimate({
                        gasPrice: ethers.utils.formatUnits(gasPrice, 'gwei'),
                        gasLimit,
                        totalCost: gasCostEth,
                        totalCostUsd: gasCostUsd
                    });
                } catch (e) {
                    console.error('Gas estimation error:', e);
                }
            };

            // Generate transaction receipt
            const generateReceipt = (tx) => {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    doc.setFontSize(24);
                    doc.setTextColor(59, 130, 246);
                    doc.text('CryptoVault', 20, 30);
                    
                    doc.setFontSize(18);
                    doc.setTextColor(0, 0, 0);
                    doc.text('Transaction Receipt', 20, 45);
                    
                    doc.setFontSize(12);
                    doc.text(`Hash: ${tx.hash.substring(0, 20)}...`, 20, 65);
                    doc.text(`From: ${getCurrentAddress().substring(0, 20)}...`, 20, 80);
                    doc.text(`To: ${tx.to.substring(0, 20)}...`, 20, 95);
                    doc.text(`Amount: ${tx.amount} ${tx.symbol}`, 20, 110);
                    doc.text(`Chain: ${CHAINS[tx.chain].name}`, 20, 125);
                    doc.text(`Status: ${tx.status}`, 20, 140);
                    doc.text(`Date: ${tx.time}`, 20, 155);
                    
                    doc.setFontSize(10);
                    doc.setTextColor(128, 128, 128);
                    doc.text('Generated by CryptoVault', 20, 280);
                    
                    doc.save(`receipt-${tx.hash.slice(0, 10)}.pdf`);
                    showMsg('Receipt downloaded successfully');
                    AnalyticsManager.track('Receipt_Downloaded', { chain: tx.chain });
                } catch (e) {
                    showMsg('Could not generate receipt');
                }
            };

            // Wallet Functions
            const createWallet = async () => {
                setLoading(true);
                AnalyticsManager.track('Wallet_Creation_Started', { chain });
                
                try {
                    if (chain === 'SOLANA' && CONFIG.FEATURES.SOLANA) {
                        const solWallet = SolanaManager.createWallet();
                        if (solWallet) {
                            setSolanaWallet(solWallet);
                            const balance = await SolanaManager.getBalance(solWallet.address, isTestnet);
                            setSolanaBalance(balance);
                            checkAndMintCard(solWallet.address);
                            showMsg('Solana wallet created successfully');
                            AnalyticsManager.track('Wallet_Created', { chain: 'SOLANA', address: solWallet.address });
                            setView('wallet');
                            fetchPrices();
                        }
                    } else {
                        const w = ethers.Wallet.createRandom();
                        const provider = await getProviderWithRetry();
                        const balance = await provider.getBalance(w.address);
                        
                        setWallet({
                            address: w.address,
                            privateKey: w.privateKey,
                            mnemonic: w.mnemonic.phrase,
                            balance: ethers.utils.formatEther(balance)
                        });
                        
                        checkAndMintCard(w.address);
                        showMsg('Wallet created successfully');
                        AnalyticsManager.track('Wallet_Created', { chain, address: w.address });
                        setView('wallet');
                        fetchPrices();
                    }
                } catch (e) {
                    showMsg('Error: ' + e.message);
                    AnalyticsManager.track('Wallet_Creation_Failed', { chain, error: e.message });
                }
                setLoading(false);
            };

            const importWallet = async () => {
                if (!seedInput.trim()) {
                    showMsg('Please enter seed phrase or private key');
                    return;
                }
                
                setLoading(true);
                AnalyticsManager.track('Wallet_Import_Started', { chain });
                
                try {
                    if (chain === 'SOLANA' && CONFIG.FEATURES.SOLANA) {
                        const solWallet = SolanaManager.importWallet(seedInput.trim());
                        if (solWallet) {
                            setSolanaWallet(solWallet);
                            const balance = await SolanaManager.getBalance(solWallet.address, isTestnet);
                            setSolanaBalance(balance);
                            
                            const existingCard = InvestorCardManager.getCard(solWallet.address);
                            if (existingCard) {
                                setInvestorCard(existingCard);
                            } else {
                                checkAndMintCard(solWallet.address);
                            }
                            
                            showMsg('Solana wallet imported successfully');
                            AnalyticsManager.track('Wallet_Imported', { chain: 'SOLANA' });
                            setSeedInput('');
                            setView('wallet');
                            fetchPrices();
                        }
                    } else {
                        const cleanSeed = seedInput.trim().toLowerCase().replace(/\s+/g, ' ');
                        const words = cleanSeed.split(' ');
                        
                        if (words.length !== 12 && words.length !== 24) {
                            showMsg('Must be 12 or 24 words');
                            setLoading(false);
                            return;
                        }
                        
                        const w = ethers.Wallet.fromMnemonic(cleanSeed);
                        const provider = await getProviderWithRetry();
                        const balance = await provider.getBalance(w.address);
                        
                        setWallet({
                            address: w.address,
                            privateKey: w.privateKey,
                            mnemonic: w.mnemonic.phrase,
                            balance: ethers.utils.formatEther(balance)
                        });
                        
                        const existingCard = InvestorCardManager.getCard(w.address);
                        if (existingCard) {
                            setInvestorCard(existingCard);
                        } else {
                            checkAndMintCard(w.address);
                        }
                        
                        showMsg('Wallet imported successfully');
                        AnalyticsManager.track('Wallet_Imported', { chain });
                        setSeedInput('');
                        setView('wallet');
                        fetchPrices();
                    }
                } catch (e) {
                    showMsg('Invalid seed phrase or private key');
                    AnalyticsManager.track('Wallet_Import_Failed', { chain, error: e.message });
                }
                setLoading(false);
            };

            const refreshBalance = async () => {
                if (chain === 'SOLANA' && CONFIG.FEATURES.SOLANA && solanaWallet) {
                    setLoading(true);
                    try {
                        const balance = await SolanaManager.getBalance(solanaWallet.address, isTestnet);
                        setSolanaBalance(balance);
                        fetchPrices();
                        showMsg('Balance refreshed');
                        AnalyticsManager.track('Balance_Refreshed', { chain: 'SOLANA' });
                    } catch (e) {
                        showMsg('Network error');
                    }
                    setLoading(false);
                    return;
                }
                
                if (!wallet) return;
                setLoading(true);
                try {
                    const provider = await getProviderWithRetry();
                    const balance = await provider.getBalance(wallet.address);
                    setWallet({...wallet, balance: ethers.utils.formatEther(balance)});
                    fetchPrices();
                    if (!isTestnet) loadTokenBalances();
                    showMsg('Balance refreshed');
                    AnalyticsManager.track('Balance_Refreshed', { chain });
                } catch (e) {
                    showMsg('Network error');
                }
                setLoading(false);
            };

            const send = async () => {
                if (!sendTo || !sendAmount) {
                    showMsg('Please fill all fields');
                    return;
                }
                
                setLoading(true);
                AnalyticsManager.track('Transaction_Started', { chain, amount: sendAmount });
                
                try {
                    if (chain === 'SOLANA' && CONFIG.FEATURES.SOLANA && solanaWallet) {
                        const result = await SolanaManager.sendTransaction(
                            solanaWallet.keypair,
                            sendTo,
                            parseFloat(sendAmount),
                            isTestnet
                        );
                        
                        if (result.success) {
                            showMsg('Transaction sent successfully');
                            
                            setTxs([{
                                hash: result.signature,
                                to: sendTo,
                                amount: sendAmount,
                                time: new Date().toLocaleString(),
                                status: 'confirmed',
                                type: 'native',
                                chain: 'SOLANA',
                                symbol: 'SOL'
                            }, ...txs]);
                            
                            AnalyticsManager.track('Transaction_Completed', { chain: 'SOLANA', amount: sendAmount });
                            refreshBalance();
                        } else {
                            showMsg('Transaction failed: ' + result.error);
                        }
                    } else {
                        if (!ethers.utils.isAddress(sendTo)) {
                            showMsg('Invalid address');
                            setLoading(false);
                            return;
                        }
                        
                        const provider = await getProviderWithRetry();
                        const signer = new ethers.Wallet(wallet.privateKey, provider);
                        const tx = await signer.sendTransaction({
                            to: sendTo,
                            value: ethers.utils.parseEther(sendAmount)
                        });
                        
                        showMsg('Transaction sent successfully');
                        
                        setTxs([{
                            hash: tx.hash,
                            to: sendTo,
                            amount: sendAmount,
                            time: new Date().toLocaleString(),
                            status: 'pending',
                            type: 'native',
                            chain: chain,
                            symbol: CHAINS[chain].symbol
                        }, ...txs]);
                        
                        tx.wait().then(() => {
                            setTxs(prev => prev.map(t => t.hash === tx.hash ? {...t, status: 'confirmed'} : t));
                            showMsg('Transaction confirmed');
                            AnalyticsManager.track('Transaction_Completed', { chain, amount: sendAmount });
                            refreshBalance();
                        });
                    }
                    
                    setSendTo('');
                    setSendAmount('');
                    setGasEstimate(null);
                    setView('wallet');
                } catch (e) {
                    showMsg('Transaction failed: ' + (e.reason || e.message));
                    AnalyticsManager.track('Transaction_Failed', { chain, error: e.message });
                }
                setLoading(false);
            };

            const sendToken = async () => {
                if (!selectedToken || !sendTo || !sendTokenAmount) {
                    showMsg('Please fill all fields');
                    return;
                }
                
                if (!ethers.utils.isAddress(sendTo)) {
                    showMsg('Invalid address');
                    return;
                }
                
                setLoading(true);
                AnalyticsManager.track('Token_Transfer_Started', { token: selectedToken.symbol, amount: sendTokenAmount });
                
                try {
                    const provider = await getProviderWithRetry();
                    const signer = new ethers.Wallet(wallet.privateKey, provider);
                    const contract = new ethers.Contract(selectedToken.address, ERC20_ABI, signer);
                    const amount = ethers.utils.parseUnits(sendTokenAmount, selectedToken.decimals);
                    const tx = await contract.transfer(sendTo, amount);
                    
                    showMsg(`${selectedToken.symbol} sent successfully`);
                    
                    setTxs([{
                        hash: tx.hash,
                        to: sendTo,
                        amount: sendTokenAmount,
                        time: new Date().toLocaleString(),
                        status: 'pending',
                        type: 'token',
                        chain: chain,
                        symbol: selectedToken.symbol
                    }, ...txs]);
                    
                    tx.wait().then(() => {
                        setTxs(prev => prev.map(t => t.hash === tx.hash ? {...t, status: 'confirmed'} : t));
                        showMsg('Transaction confirmed');
                        AnalyticsManager.track('Token_Transfer_Completed', { token: selectedToken.symbol });
                        loadTokenBalances();
                    });
                    
                    setSendTo('');
                    setSendTokenAmount('');
                    setSelectedToken(null);
                    setView('wallet');
                } catch (e) {
                    showMsg('Transaction failed: ' + (e.reason || e.message));
                    AnalyticsManager.track('Token_Transfer_Failed', { token: selectedToken.symbol, error: e.message });
                }
                setLoading(false);
            };

            // Effects
            useEffect(() => {
                if (view === 'receive' && qrRef.current) {
                    const address = getCurrentAddress();
                    if (address) {
                        qrRef.current.innerHTML = '';
                        try {
                            new QRCode(qrRef.current, {
                                text: address,
                                width: 200,
                                height: 200
                            });
                        } catch (e) {
                            console.error('QR Code error:', e);
                        }
                    }
                }
            }, [view, wallet, solanaWallet, chain]);

            useEffect(() => {
                if (wallet || solanaWallet) {
                    refreshBalance();
                }
            }, [chain, isTestnet]);

            useEffect(() => {
                if (wallet && !isTestnet && chain !== 'SOLANA') {
                    loadTokenBalances();
                }
            }, [wallet, chain, isTestnet]);

            useEffect(() => {
                AnalyticsManager.track('View_Changed', { view, chain });
            }, [view]);

            useEffect(() => {
                if (view === 'send' && sendTo && sendAmount && wallet) {
                    estimateGas(sendTo, sendAmount);
                }
            }, [sendTo, sendAmount, view]);

            const hasAnyWallet = () => {
                if (chain === 'SOLANA' && CONFIG.FEATURES.SOLANA) {
                    return solanaWallet !== null;
                }
                return wallet !== null;
            };

            // Render
            return (
                <div className={`min-h-screen ${darkMode ? 'dark' : ''}`}>
                    <div className="professional-gradient min-h-screen p-4 md:p-8">
                        <div className="max-w-4xl mx-auto">
                            
                            {/* Header */}
                            <div className="flex justify-between items-center mb-6">
                                <div>
                                    <h1 className="text-3xl font-bold text-white">CryptoVault</h1>
                                    <p className="text-white/70 text-sm">Professional Multi-Chain Wallet</p>
                                </div>
                                <button
                                    onClick={() => setDarkMode(!darkMode)}
                                    className="p-3 card rounded-xl transition hover:shadow-lg"
                                >
                                    <span className="text-xl">{darkMode ? '' : ''}</span>
                                </button>
                            </div>

                            {/* Investor Card Modal */}
                            {showCardModal && investorCard && (
                                <div className="fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center p-4 z-50">
                                    <div className="card rounded-2xl p-8 max-w-md w-full text-center">
                                        <div className="text-6xl mb-4"></div>
                                        <h2 className="text-3xl font-bold mb-4">Congratulations!</h2>
                                        <p className="text-lg mb-6">You are one of the first 1000 investors!</p>
                                        
                                        <div className="investor-badge mb-6">
                                            <p className="text-sm mb-2">INVESTOR ACCESS CARD</p>
                                            <p className="text-4xl font-bold mb-2">#{investorCard.serialNumber}</p>
                                            <p className="text-xs">Serial {investorCard.serialNumber} of {CONFIG.LIMITS.MAX_INVESTOR_CARDS}</p>
                                        </div>
                                        
                                        <button
                                            onClick={() => setShowCardModal(false)}
                                            className="w-full py-4 rounded-xl btn-primary text-white font-bold"
                                        >
                                            Continue
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Message */}
                            {message && (
                                <div className="card rounded-xl p-4 mb-4 text-center font-semibold">
                                    {message}
                                </div>
                            )}

                            {/* Welcome View */}
                            {view === 'welcome' && (
                                <div className="card rounded-2xl p-8">
                                    <div className="text-center mb-8">
                                        <h2 className="text-3xl font-bold mb-4">Welcome to CryptoVault</h2>
                                        <p className="text-gray-600 dark:text-gray-400 mb-6">
                                            Professional multi-chain cryptocurrency wallet supporting 15+ blockchains
                                        </p>
                                        
                                        {InvestorCardManager.getTotalMinted() < CONFIG.LIMITS.MAX_INVESTOR_CARDS && (
                                            <div className="investor-badge mb-6">
                                                Only {CONFIG.LIMITS.MAX_INVESTOR_CARDS - InvestorCardManager.getTotalMinted()} Investor Cards Remaining
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="mb-6">
                                        <label className="block mb-3 font-semibold">Select Your Network</label>
                                        <div className="chain-grid">
                                            {Object.entries(CHAINS).map(([key, c]) => (
                                                <div
                                                    key={key}
                                                    onClick={() => setChain(key)}
                                                    className={`chain-card ${chain === key ? 'selected' : ''}`}
                                                >
                                                    <div className="text-2xl mb-2" style={{ color: c.color }}></div>
                                                    <p className="font-bold text-sm">{c.name}</p>
                                                    <p className="text-xs text-gray-500 dark:text-gray-400">{c.symbol}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <button
                                        onClick={createWallet}
                                        disabled={loading}
                                        className="w-full py-4 rounded-xl btn-primary text-white font-bold mb-4 disabled:opacity-50"
                                    >
                                        {loading ? <span className="spinner"></span> : 'Create New Wallet'}
                                    </button>

                                    <div className="relative mb-4">
                                        <div className="absolute inset-0 flex items-center">
                                            <div className="w-full border-t border-gray-300 dark:border-gray-600"></div>
                                        </div>
                                        <div className="relative flex justify-center text-sm">
                                            <span className="px-2 bg-white dark:bg-gray-800 text-gray-500">or</span>
                                        </div>
                                    </div>

                                    <textarea
                                        value={seedInput}
                                        onChange={(e) => setSeedInput(e.target.value)}
                                        placeholder={chain === 'SOLANA' ? 'Enter private key (hex) to import...' : 'Enter 12 or 24 word seed phrase to import...'}
                                        className="w-full p-4 rounded-xl bg-white dark:bg-gray-800 mb-4 min-h-[100px]"
                                    />
                                    
                                    <button
                                        onClick={importWallet}
                                        disabled={loading}
                                        className="w-full py-4 rounded-xl bg-gray-600 hover:bg-gray-700 text-white font-bold disabled:opacity-50"
                                    >
                                        {loading ? <span className="spinner"></span> : 'Import Existing Wallet'}
                                    </button>
                                </div>
                            )}

                            {/* Wallet View */}
                            {view === 'wallet' && hasAnyWallet() && (
                                <div className="space-y-4">
                                    {/* Investor Card Badge */}
                                    {investorCard && (
                                        <div className="investor-badge cursor-pointer hover:shadow-lg transition">
                                            Investor Card #{investorCard.serialNumber}  Tap for details
                                        </div>
                                    )}
                                    
                                    {/* Network Selector */}
                                    <div className="card rounded-xl p-4">
                                        <label className="block mb-2 font-semibold">Current Network</label>
                                        <div className="chain-grid mb-4">
                                            {Object.entries(CHAINS).map(([key, c]) => (
                                                <div
                                                    key={key}
                                                    onClick={() => setChain(key)}
                                                    className={`chain-card ${chain === key ? 'selected' : ''}`}
                                                >
                                                    <div className="text-xl mb-1" style={{ color: c.color }}></div>
                                                    <p className="font-bold text-xs">{c.name}</p>
                                                </div>
                                            ))}
                                        </div>
                                        
                                        <div className="flex items-center gap-2">
                                            <button
                                                onClick={() => setIsTestnet(true)}
                                                className={`flex-1 py-2 rounded-lg font-semibold transition ${isTestnet ? 'bg-orange-500 text-white' : 'bg-gray-200 dark:bg-gray-700'}`}
                                            >
                                                Testnet
                                            </button>
                                            <button
                                                onClick={() => setIsTestnet(false)}
                                                className={`flex-1 py-2 rounded-lg font-semibold transition ${!isTestnet ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-700'}`}
                                            >
                                                Mainnet
                                            </button>
                                        </div>
                                    </div>

                                    {/* Balance Card */}
                                    <div className="card rounded-2xl p-8 professional-gradient">
                                        <p className="text-white/80 mb-2 font-semibold">Total Balance</p>
                                        <h2 className="text-5xl font-bold text-white mb-2">
                                            {parseFloat(getCurrentBalance()).toFixed(6)} {CHAINS[chain].symbol}
                                        </h2>
                                        <p className="text-white/90 text-xl font-semibold mb-6"> ${getUsdValue()} USD</p>
                                        
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => copyToClipboard(getCurrentAddress())}
                                                className="flex-1 py-3 bg-white/20 backdrop-blur rounded-xl text-white font-semibold hover:bg-white/30 transition"
                                            >
                                                Copy Address
                                            </button>
                                            <button
                                                onClick={refreshBalance}
                                                disabled={loading}
                                                className="flex-1 py-3 bg-white/20 backdrop-blur rounded-xl text-white font-semibold hover:bg-white/30 transition disabled:opacity-50"
                                            >
                                                {loading ? <span className="spinner"></span> : 'Refresh'}
                                            </button>
                                        </div>
                                        
                                        <div className="mt-4 text-xs text-white/70 break-all bg-black/20 p-3 rounded font-mono">
                                            {getCurrentAddress()}
                                        </div>
                                    </div>

                                    {/* Action Buttons */}
                                    <div className="grid grid-cols-4 gap-3">
                                        <button
                                            onClick={() => setView('send')}
                                            className="card p-6 rounded-xl text-center hover:shadow-lg transition"
                                        >
                                            <div className="text-3xl mb-2"></div>
                                            <p className="font-bold text-xs">Send</p>
                                        </button>
                                        <button
                                            onClick={() => setView('receive')}
                                            className="card p-6 rounded-xl text-center hover:shadow-lg transition"
                                        >
                                            <div className="text-3xl mb-2"></div>
                                            <p className="font-bold text-xs">Receive</p>
                                        </button>
                                        <button
                                            onClick={() => setView('tokens')}
                                            className="card p-6 rounded-xl text-center hover:shadow-lg transition"
                                            disabled={chain === 'SOLANA'}
                                        >
                                            <div className="text-3xl mb-2"></div>
                                            <p className="font-bold text-xs">Tokens</p>
                                        </button>
                                        <button
                                            onClick={() => setView('security')}
                                            className="card p-6 rounded-xl text-center hover:shadow-lg transition"
                                        >
                                            <div className="text-3xl mb-2"></div>
                                            <p className="font-bold text-xs">Security</p>
                                        </button>
                                    </div>

                                    {/* Recent Transactions */}
                                    {txs.length > 0 && (
                                        <div className="card rounded-2xl p-6">
                                            <h3 className="text-xl font-bold mb-4">Recent Transactions</h3>
                                            <div className="space-y-3">
                                                {txs.slice(0, 5).map((tx, i) => (
                                                    <div key={i} className="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">
                                                        <div className="flex-1">
                                                            <p className="font-semibold">{tx.type === 'token' ? 'Token Transfer' : 'Sent'}</p>
                                                            <p className="text-sm text-gray-600 dark:text-gray-400">{tx.amount} {tx.symbol}</p>
                                                            <p className="text-xs text-gray-400 font-mono">{tx.hash.substring(0, 20)}...</p></div>
                                                        <div className="flex flex-col items-end gap-2">
                                                            <span className={`text-xs px-3 py-1 rounded-full ${tx.status === 'confirmed' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'}`}>
                                                                {tx.status}
                                                            </span>
                                                            <button
                                                                onClick={() => generateReceipt(tx)}
                                                                className="text-xs px-3 py-1 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition"
                                                            >
                                                                Receipt
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Send View */}
                            {view === 'send' && (
                                <div className="card rounded-2xl p-8">
                                    <button
                                        onClick={() => setView('wallet')}
                                        className="mb-6 text-blue-600 dark:text-blue-400 font-semibold hover:underline"
                                    >
                                         Back to Wallet
                                    </button>
                                    
                                    <h2 className="text-2xl font-bold mb-6">Send {CHAINS[chain].symbol}</h2>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block mb-2 font-semibold">Recipient Address</label>
                                            <input
                                                type="text"
                                                value={sendTo}
                                                onChange={(e) => setSendTo(e.target.value)}
                                                placeholder={chain === 'SOLANA' ? 'Solana address...' : '0x...'}
                                                className="w-full p-4 rounded-xl bg-white dark:bg-gray-800"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block mb-2 font-semibold">Amount</label>
                                            <input
                                                type="number"
                                                step="0.000001"
                                                value={sendAmount}
                                                onChange={(e) => setSendAmount(e.target.value)}
                                                placeholder="0.0"
                                                className="w-full p-4 rounded-xl bg-white dark:bg-gray-800"
                                            />
                                            <p className="text-sm text-gray-500 mt-2">
                                                Available: {getCurrentBalance()} {CHAINS[chain].symbol}
                                            </p>
                                        </div>
                                        
                                        {gasEstimate && CONFIG.FEATURES.GAS_ESTIMATION && (
                                            <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl">
                                                <p className="font-semibold mb-2">Gas Estimate</p>
                                                <div className="text-sm space-y-1">
                                                    <p>Gas Price: {parseFloat(gasEstimate.gasPrice).toFixed(2)} Gwei</p>
                                                    <p>Gas Limit: {gasEstimate.gasLimit}</p>
                                                    <p>Total Cost: {parseFloat(gasEstimate.totalCost).toFixed(6)} {CHAINS[chain].symbol}</p>
                                                    <p className="font-bold"> ${gasEstimate.totalCostUsd} USD</p>
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div className="bg-green-50 dark:bg-green-900/20 p-4 rounded-xl">
                                            <p className="text-green-800 dark:text-green-200 font-semibold">Platform Fee: $0.00 (FREE)</p>
                                            <p className="text-xs text-gray-600 dark:text-gray-400 mt-1">You only pay network gas fees</p>
                                        </div>
                                        
                                        <button
                                            onClick={send}
                                            disabled={loading}
                                            className="w-full py-4 rounded-xl btn-primary text-white font-bold disabled:opacity-50"
                                        >
                                            {loading ? <span className="spinner"></span> : 'Send Transaction'}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Receive View */}
                            {view === 'receive' && (
                                <div className="card rounded-2xl p-8 text-center">
                                    <button
                                        onClick={() => setView('wallet')}
                                        className="mb-6 text-blue-600 dark:text-blue-400 font-semibold float-left hover:underline"
                                    >
                                         Back
                                    </button>
                                    <div className="clear-both"></div>
                                    
                                    <h2 className="text-2xl font-bold mb-6">Receive {CHAINS[chain].symbol}</h2>
                                    
                                    <div className="bg-white dark:bg-gray-800 p-6 rounded-xl inline-block mb-6">
                                        <div ref={qrRef}></div>
                                    </div>
                                    
                                    <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-xl mb-4 break-all">
                                        <p className="font-mono text-sm">{getCurrentAddress()}</p>
                                    </div>
                                    
                                    <button
                                        onClick={() => copyToClipboard(getCurrentAddress())}
                                        className="w-full py-4 rounded-xl btn-primary text-white font-bold"
                                    >
                                        Copy Address
                                    </button>
                                    
                                    <p className="text-sm text-gray-500 dark:text-gray-400 mt-4">
                                        Only send {CHAINS[chain].symbol} to this address on {CHAINS[chain].name} {isTestnet ? 'Testnet' : 'Mainnet'}
                                    </p>
                                </div>
                            )}

                            {/* Tokens View */}
                            {view === 'tokens' && chain !== 'SOLANA' && (
                                <div className="card rounded-2xl p-8">
                                    <button
                                        onClick={() => setView('wallet')}
                                        className="mb-6 text-blue-600 dark:text-blue-400 font-semibold hover:underline"
                                    >
                                         Back
                                    </button>
                                    
                                    <h2 className="text-2xl font-bold mb-6">Tokens (USDT & USDC)</h2>
                                    
                                    {isTestnet ? (
                                        <div className="text-center py-12">
                                            <p className="text-6xl mb-4"></p>
                                            <p className="text-gray-600 dark:text-gray-400 font-semibold mb-2">Tokens Only Available on Mainnet</p>
                                            <p className="text-sm text-gray-500">Switch to mainnet to view your tokens</p>
                                        </div>
                                    ) : loadingTokens ? (
                                        <div className="text-center py-12">
                                            <span className="spinner text-6xl"></span>
                                            <p className="mt-4 text-gray-600 dark:text-gray-400">Loading tokens...</p>
                                        </div>
                                    ) : tokens.length === 0 ? (
                                        <div className="text-center py-12">
                                            <p className="text-6xl mb-4"></p>
                                            <p className="text-gray-600 dark:text-gray-400 font-semibold mb-2">No Tokens Found</p>
                                            <p className="text-sm text-gray-500">
                                                {TOKEN_ADDRESSES[chain] ? 'You have no USDT or USDC tokens' : 'Tokens not supported on this chain'}
                                            </p>
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {tokens.map((token, i) => (
                                                <div
                                                    key={i}
                                                    className="token-item"
                                                    onClick={() => {
                                                        setSelectedToken(token);
                                                        setView('send-token');
                                                    }}
                                                >
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <p className="font-bold text-lg">{token.symbol}</p>
                                                            <p className="text-sm text-gray-600 dark:text-gray-400">{token.name}</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <p className="font-bold text-lg">{parseFloat(token.balance).toFixed(4)}</p>
                                                            <p className="text-sm text-gray-600 dark:text-gray-400">
                                                                ${(parseFloat(token.balance) * (prices[token.symbol] || 1)).toFixed(2)}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Send Token View */}
                            {view === 'send-token' && selectedToken && (
                                <div className="card rounded-2xl p-8">
                                    <button
                                        onClick={() => {
                                            setView('tokens');
                                            setSelectedToken(null);
                                        }}
                                        className="mb-6 text-blue-600 dark:text-blue-400 font-semibold hover:underline"
                                    >
                                         Back to Tokens
                                    </button>
                                    
                                    <h2 className="text-2xl font-bold mb-6">Send {selectedToken.symbol}</h2>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block mb-2 font-semibold">Recipient Address</label>
                                            <input
                                                type="text"
                                                value={sendTo}
                                                onChange={(e) => setSendTo(e.target.value)}
                                                placeholder="0x..."
                                                className="w-full p-4 rounded-xl bg-white dark:bg-gray-800"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block mb-2 font-semibold">Amount</label>
                                            <input
                                                type="number"
                                                step="0.000001"
                                                value={sendTokenAmount}
                                                onChange={(e) => setSendTokenAmount(e.target.value)}
                                                placeholder="0.0"
                                                className="w-full p-4 rounded-xl bg-white dark:bg-gray-800"
                                            />
                                            <p className="text-sm text-gray-500 mt-2">
                                                Available: {parseFloat(selectedToken.balance).toFixed(4)} {selectedToken.symbol}
                                            </p>
                                        </div>
                                        
                                        <div className="bg-green-50 dark:bg-green-900/20 p-4 rounded-xl">
                                            <p className="text-green-800 dark:text-green-200 font-semibold">Platform Fee: FREE</p>
                                        </div>
                                        
                                        <button
                                            onClick={sendToken}
                                            disabled={loading}
                                            className="w-full py-4 rounded-xl btn-primary text-white font-bold disabled:opacity-50"
                                        >
                                            {loading ? <span className="spinner"></span> : `Send ${selectedToken.symbol}`}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Security View */}
                            {view === 'security' && (
                                <div className="card rounded-2xl p-8">
                                    <button
                                        onClick={() => setView('wallet')}
                                        className="mb-6 text-blue-600 dark:text-blue-400 font-semibold hover:underline"
                                    >
                                         Back
                                    </button>
                                    
                                    <h2 className="text-2xl font-bold mb-6">Security & Backup</h2>
                                    
                                    <div className="bg-red-50 dark:bg-red-900/20 p-6 rounded-xl mb-6">
                                        <p className="text-red-800 dark:text-red-200 font-semibold mb-2">Critical Warning</p>
                                        <p className="text-sm text-red-700 dark:text-red-300">
                                            Never share your private keys or seed phrase with anyone. Anyone with access has complete control of your funds.
                                        </p>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {chain === 'SOLANA' && solanaWallet ? (
                                            <div className="bg-gray-50 dark:bg-gray-800 p-6 rounded-xl">
                                                <div className="flex justify-between items-center mb-4">
                                                    <h3 className="font-bold text-lg">Solana Private Key</h3>
                                                    <button
                                                        onClick={() => setShowSeed(!showSeed)}
                                                        className="text-blue-600 dark:text-blue-400 font-semibold hover:underline"
                                                    >
                                                        {showSeed ? 'Hide' : 'Show'}
                                                    </button>
                                                </div>
                                                {showSeed ? (
                                                    <>
                                                        <p className="font-mono text-xs break-all bg-white dark:bg-gray-700 p-3 rounded mb-4">
                                                            {solanaWallet.privateKey}
                                                        </p>
                                                        <button
                                                            onClick={() => copyToClipboard(solanaWallet.privateKey)}
                                                            className="w-full py-3 bg-blue-500 text-white rounded-xl font-semibold hover:bg-blue-600 transition"
                                                        >
                                                            Copy Private Key
                                                        </button>
                                                    </>
                                                ) : (
                                                    <p className="text-gray-500 text-center py-4">Click Show to reveal</p>
                                                )}
                                            </div>
                                        ) : wallet ? (
                                            <>
                                                <div className="bg-gray-50 dark:bg-gray-800 p-6 rounded-xl">
                                                    <div className="flex justify-between items-center mb-4">
                                                        <h3 className="font-bold text-lg">Recovery Phrase</h3>
                                                        <button
                                                            onClick={() => setShowSeed(!showSeed)}
                                                            className="text-blue-600 dark:text-blue-400 font-semibold hover:underline"
                                                        >
                                                            {showSeed ? 'Hide' : 'Show'}
                                                        </button>
                                                    </div>
                                                    {showSeed ? (
                                                        <>
                                                            <div className="grid grid-cols-3 gap-2 mb-4">
                                                                {wallet.mnemonic.split(' ').map((word, i) => (
                                                                    <div key={i} className="bg-white dark:bg-gray-700 p-2 rounded text-center">
                                                                        <span className="text-xs text-gray-500">{i + 1}.</span>
                                                                        <p className="font-mono font-semibold text-sm">{word}</p>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                            <button
                                                                onClick={() => copyToClipboard(wallet.mnemonic)}
                                                                className="w-full py-3 bg-blue-500 text-white rounded-xl font-semibold hover:bg-blue-600 transition"
                                                            >
                                                                Copy Recovery Phrase
                                                            </button>
                                                        </>
                                                    ) : (
                                                        <p className="text-gray-500 text-center py-4">Click Show to reveal</p>
                                                    )}
                                                </div>
                                                
                                                <div className="bg-gray-50 dark:bg-gray-800 p-6 rounded-xl">
                                                    <h3 className="font-bold text-lg mb-4">Private Key</h3>
                                                    {showSeed ? (
                                                        <>
                                                            <p className="font-mono text-xs break-all bg-white dark:bg-gray-700 p-3 rounded mb-4">
                                                                {wallet.privateKey}
                                                            </p>
                                                            <button
                                                                onClick={() => copyToClipboard(wallet.privateKey)}
                                                                className="w-full py-3 bg-blue-500 text-white rounded-xl font-semibold hover:bg-blue-600 transition"
                                                            >
                                                                Copy Private Key
                                                            </button>
                                                        </>
                                                    ) : (
                                                        <p className="text-gray-500 text-center py-4">Show recovery phrase first</p>
                                                    )}
                                                </div>
                                            </>
                                        ) : null}
                                        
                                        <div className="bg-blue-50 dark:bg-blue-900/20 p-6 rounded-xl">
                                            <h3 className="font-bold mb-3">Security Best Practices</h3>
                                            <ul className="space-y-2 text-sm text-gray-700 dark:text-gray-300">
                                                <li> Write recovery phrase on paper and store securely</li>
                                                <li> Never take screenshots or store digitally</li>
                                                <li> Never share with anyone, including support staff</li>
                                                <li> Keep multiple physical backups in secure locations</li>
                                                <li> Verify recipient addresses carefully before sending</li>
                                                <li> Always test with small amounts first</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Footer */}
                            <div className="text-center mt-8 text-white/70 text-sm space-y-2">
                                <p className="font-semibold">CryptoVault - Professional Multi-Chain Wallet</p>
                                <p className="text-xs">Supporting 15+ Blockchains Worldwide</p>
                                <div className="flex flex-wrap justify-center gap-2 text-xs">
                                    {Object.values(CHAINS).slice(0, 8).map((c, i) => (
                                        <span key={i} className="px-2 py-1 bg-white/10 rounded">
                                            {c.name}
                                        </span>
                                    ))}
                                </div>
                                {InvestorCardManager.getTotalMinted() < CONFIG.LIMITS.MAX_INVESTOR_CARDS && (
                                    <p className="text-yellow-300 font-semibold">
                                        {CONFIG.LIMITS.MAX_INVESTOR_CARDS - InvestorCardManager.getTotalMinted()} Investor Cards Remaining
                                    </p>
                                )}
                                <p className="text-xs mt-4">Powered by Infura, Alchemy & Solana Web3.js</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
